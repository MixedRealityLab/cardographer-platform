# Authoring Cards

## Spreadsheets

Card metadata is typically provided by a .CSV file which can be 
exported from most spreadsheets. 
It should be in UTF-8 character encoding.

The first row is the header row and should always be included.

There are two versions: with and with row type information.
With row type information the first column contains the type of 
data in the row (!). 
The row types are (NB lower case and including the ":"):
- "title:" - must be the first cell on the first row - the rest of the row
  is the normal column titles
- "use:" - the "use" or purpose of the values in the respective column.
  See the [data model](datamodel.md)
- "export:" - whether to include the respective column in the default 
  export (unless blank, "0", "n..." or "f...")
- "default:" - row values are defaults for all cards
- "card:" - row represents a normal card.
- "back:" - row represents information for card back

A regular (non-typed) spreadsheet always has the title row first, then
all remaining rows are considered to be card rows.

## Squib builder

The squib builder is currently/initially based on some simple
[databox health cards](https://github.com/cgreenhalgh/databox-health-cards).

If you look in the files for the deck/revision you will find:
- `deck.rb`, the main deck building application, which specifies 
  which layout file(s) to load (layout.yml), which spreadsheet to 
  load (card-data.csv, which is generated by the builder), what
  content to add to each card based on those, and what output to
  generate (cards pngs, an atlas and a PDF) and any associated
  squib configuration
- `config.yml`, generic squib config, not obviously important/useful.
- `layout.yml`, a specification of text and image areas defining
  general card layout elements to be used in `deck.rb`
- `icons/`, a directory containing icon files (in this project assumed
  to be .svg files)
- `icons/credits.yml`, the credits to go with each icon file
- `_output/`, where outputs go (by default, and assumed by builder)
- `_output/card_00.png` (etc.) individual card image (back is last)
- `_output/Atlas_0.png` (etc.) texture atlas file(s), with up to 5x3
  cards per image (configured in `ruby.rb`)
- `_output/sheet.png` actually a PDF file, misnamed by squib, with
  print-and-cut versions of the cards (back appears only once like
  in the atlas, though)

Note that:
- the current `deck.rb` handles the last card differently
  to make the back. This is done using the `range:` parameters on the
  various `background`, `text` and `svg` commands.
- the layout file has positions in pixels, and currently assumes 300 DPI
  (which is the default, but also set explicitly in `ruby.rb`).
- the card size 59x88mm is set in `ruby.rb`
- `card-data.csv` is auto-generated by the squib builder plugin in 
  cardographer, and has an extra line added (compared to the normal
  card spreadsheet) with the card back. You can see/edit the information
  for this using the CSV export `include column metadata` option, which
  will include a row `back:`.

IMPORTANT: 
At the moment, if you change the output file options (e.g. file names,
atlas settings) then it won't work with the rest of the web platform.
But you can change the layout and add new columns to the card spreadsheet
without causing any problems.

