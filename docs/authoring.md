# Authoring Cards

## Spreadsheets

Card metadata is typically provided by a .CSV file which can be 
exported from most spreadsheets. 
It should be in UTF-8 character encoding.

The first row is the header row and should always be included.

There are two versions: with and with row type information.
With row type information the first column contains the type of 
data in the row (!). 
The row types are (NB lower case and including the ":"):
- "title:" - must be the first cell on the first row - the rest of the row
  is the normal column titles
- "use:" - the "use" or purpose of the values in the respective column.
  See the [data model](datamodel.md)
- "export:" - whether to include the respective column in the default 
  export (unless blank, "0", "n..." or "f...")
- "default:" - row values are defaults for all cards
- "card:" - row represents a normal card.
- "back:" - row represents information for card back

A regular (non-typed) spreadsheet always has the title row first, then
all remaining rows are considered to be card rows.

Note that cards with an ID starting 'back:' define a card back, not a card.

The column with use 'back' specifies the rest of the ID of the back
to use with that card. 
All cards with the same back are built together as a unit (e.g. a PDF
and a multi-image texture atlas). So a set of cards with the same back 
is the unit of loading in the unity client. 

## Squib builder

The squib builder is currently/initially based on some simple
[databox health cards](https://github.com/cgreenhalgh/databox-health-cards).

If you look in the files for the deck/revision you will find:
- `deck.rb`, the main deck building application, which specifies 
  which layout file(s) to load (layout.yml), which spreadsheet to 
  load (card-data.csv, which is generated by the builder), what
  content to add to each card based on those, and what output to
  generate (cards pngs, an atlas and a PDF) and any associated
  squib configuration
- `config.yml`, generic squib config, not obviously important/useful.
- `layout.yml`, a specification of text and image areas defining
  general card layout elements to be used in `deck.rb`
- `options.yml`, most of the deck settings extracted from deck.rb,
  e.g. card size, layout file to use, output filenames.
- `_output/`, where outputs go (required by builder)
- `_output/card_00.png` (etc.) individual card image (back is last)
  (with a prefix if using a named back) - these are automatically
  renamed to match the card's ID (with a prefix if using a named back).
- `_output/Atlas_0.png` (etc.) texture atlas file(s), with up to 5x3
  cards per image (configured in `ruby.rb` from `options.yml`) 
  (with a prefix if using a named back)
- `_output/output.pdf` - print versions of the cards, as configured
  in `deck.rb`. A squib "sprue" is probably needed to print a more useful 
  version.
- `icons/`, (optional) a directory containing icon files (in this project assumed
  to be .svg files)
- `icons/credits.yml`, the credits to go with each icon file - this is
  specific to this project and handled in `deck.rb`.

Cardographer will call squib once for each card back, passing
it only the cards with that back, followed by the back card (once only).
This is required to build the image atlases used by the virtual table top
and the individual card image files. The property `last_is_back` will be
true in the `options.yml` file.

Note, if the property `even_is_back` is set in the `options.yml` file then
the builder will also call squib once with ALL the cards, with face and 
back cards alternating. This can be used to generate a complete PDF for
commercial card printing (see the RRI cards example).

Note that:
- the current `deck.rb` handles the last card differently
  to make the back if `last_is_back` is set in `options.yml`. 
  This is done using the `range:` parameters on the
  various `background`, `text` and `svg` commands. 
- Coping with the 
  `even_is_back` option as well is a bit more complicated, e.g. see the
  RRI card example, which uses a `layers` attribute in the card definitions.
- the layout file has positions in pixels, but usually expressed in units of 
  mm, in or c, where 1c = 1/8th inch.
- The default resolution is 300 DPI, which is also set explicitly in `ruby.rb` from
  `options.yml`.
- the card size (e.g. 59x88mm) is set in `ruby.rb` from `options.yml`.
  Note that cards for printing must include the printer's bleed size in the overall
  card size. It can be removed from the output images using the `trim` 
  argument to the `save_...` commands.
- `card-data.csv` is auto-generated by the squib builder plugin in 
  cardographer, and is generated (with a unique prefix) for each 
  different card back in the deck. An entry is always included for the
  back with an id 'back:...' if it is not already defined.
- at the moment some of the settings in options.yml are over-ridden by
  the build process, e.g. csvfile, output directory, filename prefixes.
- US and UK cards sizes are typically imperial and metric, respectively, which 
  are very slightly different (about 1mm).
- different printers may have different bleed sizes (e.g. 3mm vs 1/8th inch) and
  different safe boundaries (e.g. 5mm vs 1/8th inch). So the exact layout will
  depend on where you are getting the final version printed.
